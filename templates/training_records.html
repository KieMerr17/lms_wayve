{% extends 'dashboard.html' %}
{% load static %}

{% block content %}
    <h1>Training Records</h1>
    <p>Here you can view all of your training records, grouped by type.</p>

    <!-- Grouped by training type -->
    {% for training_type, records in training_records.items %}
        <h2>{{ training_type }} Training</h2>

        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Training Title</th>
                        <th>Date</th>
                        <th>Status</th>
                        <th>Report</th>
                    </tr>
                </thead>
                <tbody>
                    {% for record in records %}
                        <tr>
                            <td>{{ record.training_title }}</td>
                            <td>{{ record.date }}</td>
                            <td>{{ record.status }}</td>
                            <td>
                                {% if record.supporting_document %}
                                    <a href="javascript:void(0)" onclick="openModal('{{ record.supporting_document.url }}', '{{ record.training_title|escapejs }}', 'document')">
                                        View File
                                    </a>
                                {% elif record.supporting_document_url %}
                                    <a href="javascript:void(0)" onclick="openModal('{{ record.supporting_document_url }}', '{{ record.training_title|escapejs }}', 'url')">
                                        View File
                                    </a>
                                {% else %}
                                    No document
                                {% endif %}
                            </td>
                        </tr>
                    {% empty %}
                        <tr>
                            <td colspan="4">No records available for {{ training_type }} training.</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% endfor %}
    
    {% if training_records|length == 0 %}
        <p>No training records found.</p>
    {% endif %}

    <!-- Modal Structure -->
    <div id="modal" class="modal" style="display: none; justify-content: center; align-items: center;">
        <div class="modal-content" style="position: relative; width: 80%; height: 80%;">
            <span class="close" onclick="closeModal()" style="cursor: pointer; position: absolute; top: 10px; right: 20px;">&times;</span>
            <h2 id="modal-title"></h2>
            <!-- PDF or URL Preview -->
            <iframe id="modal-iframe" style="width: 100%; height: 100%; border: none;"></iframe>
        </div>
    </div>

    <script>
        // Function to open the modal and display either the document or URL in an iframe
        function openModal(contentUrl, contentTitle, contentType) {
            const modal = document.getElementById("modal");
            const modalTitle = document.getElementById("modal-title");
            const modalIframe = document.getElementById("modal-iframe");

            // Set the title of the modal
            modalTitle.innerText = contentTitle;

            // Reset the iframe source before loading new content
            modalIframe.src = "";

            // If the content type is 'url', open the link in the modal iframe
            if (contentType === 'url') {
                modalIframe.src = contentUrl;
            } else {
                // Handle document logic (e.g., PDF preview)
                modalIframe.src = contentUrl;
            }

            // Display the modal
            modal.style.display = "flex";
        }

        // Function to close the modal
        function closeModal() {
            const modal = document.getElementById("modal");
            const modalIframe = document.getElementById("modal-iframe");

            // Hide the modal and clear the iframe content
            modal.style.display = "none";
            modalIframe.src = ""; // Clear the iframe source
        }

        // Optional: Close the modal if the user clicks outside of the modal content
        window.onclick = function(event) {
            const modal = document.getElementById("modal");
            if (event.target === modal) {
                closeModal();
            }
        }
    </script>
{% endblock %}
